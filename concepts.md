# Theoretical concepts

This documentation page aims to shortly summarize some of the most important theory related to the certification preparation and overall knowledge about containers and container security ðŸ“š

- [Theoretical concepts](#theoretical-concepts)
  - [Docker](#docker)
    - [Docker achitecture](#docker-achitecture)
      - [Docker Engine](#docker-engine)
      - [Docker Objects](#docker-objects)
    - [Docker alternatives](#docker-alternatives)
    - [Docker Networking](#docker-networking)
    - [Dockerfile Instructions](#dockerfile-instructions)

## Docker

### Docker achitecture

![Docker architecture](docs/img/ccse-docker-architecture.png)

Docker is a powerful platform designed to make it easier to create, deploy, and run applications by using containers. Containers allow developers to package an application with all of its dependencies into a standardized unit for software development. Docker's architecture is key to its functionality, enabling both development and operations teams to work more efficiently. Here's an overview of Docker's architecture within a 70-line constraint:

#### Docker Engine

The Docker Engine is the core of Docker, a lightweight and powerful open-source containerization technology combined with a workable API. The Engine creates and manages Docker containers. It's a client-server based application comprising three major components:

1. **Docker Daemon (`dockerd`):** The server part of the engine that listens for Docker API requests and manages Docker objects such as images, containers, networks, and volumes. It's the process that actually executes the containers.

2. **REST API:** An interface that programs can use to talk to the daemon and instruct it what to do.

3. **Docker CLI (`docker`):** The command line interface that allows users to interact with Docker using commands.

#### Docker Objects

- **Images:** An immutable file that's essentially a snapshot of a container. Images serve as the basis of containers. An image includes everything needed to run an application - the code or binary, runtimes, dependencies, and any other filesystem objects required.

- **Containers:** An abstraction at the app layer that packages code and dependencies together. Multiple containers can run on the same hardware more efficiently than if using virtual machines. Containers are created from images, and they can be started, stopped, moved, and deleted.

- **Volumes:** Provide persistent storage for a Docker container. They are essential for when you need to store data generated by and used by Docker containers.

- **Networks:** Enable isolated networks to be defined and managed by Docker. They provide connectivity between containers on the same host or across different hosts.

---

### Docker alternatives

1. [Podman](https://podman.io/) - Podman is a daemonless, open source, Linux native tool designed to make it easy to find, run, build, share and deploy applications using Open Containers Initiative (OCI) Containers and Container Images.
2. [CRI-O:](https://cri-o.io/) - Container management solution optimized for Kubernetes compliant with OCI specification.
3. [Linux Containers - LXC](https://linuxcontainers.org/lxc/getting-started/)

---

### Docker Networking

Docker supports multiple networking options, each tailored for specific use cases:

- **Bridge:** The default network driver, suitable for containers' communication on the same host.
- **Host:** Removes network isolation between container and host, offering performance improvement.
- **Overlay:** Enables network communication between containers across different hosts, crucial for Docker Swarm.
- **Macvlan:** Allows assigning a MAC address to a container, making it appear as a physical device on the network.
- **None:** Disables all networking, useful for containers that don't require network communication.

> [!NOTE]
> Docker default network is `Bridge`.

---

### Dockerfile Instructions

- `FROM`: Initializes a new build stage and sets the base image.
- `RUN`: Executes commands in a new layer on top of the current image and commits the results.
- `CMD`: Provides defaults for an executing container.
- `LABEL`: Adds metadata to an image.
- `EXPOSE`: Informs Docker that the container listens on specific network ports at runtime.
- `ENV`: Sets the environment variable.
- `ADD`: Copies new files, directories, or remote file URLs and adds them to the filesystem of the image.
- `COPY`: Copies new files or directories and adds them to the filesystem of the container.
- `ENTRYPOINT`: Configures a container that will run as an executable.
- `VOLUME`: Creates a mount point with the specified name and marks it as holding externally mounted volumes from the native host or other containers.
- `USER`: Sets the username or UID to use when running the image.
- `WORKDIR`: Sets the working directory for any RUN, CMD, ENTRYPOINT, COPY, and ADD instructions that follow it.
- `ARG`: Defines a variable that users can pass at build-time to the builder with the docker build command.
- `ONBUILD`: Adds a trigger instruction to be executed at a later time, when the image is used as the base for another build.
- `STOPSIGNAL`: Sets the system call signal that will be sent to the container to exit.
- `HEALTHCHECK`: Tells Docker how to test a container to check that it is still working.
- `SHELL`: Allows the default shell used for the shell form of commands to be overridden.

> [!IMPORTANT]
> Do not forget this security tips to define more secure images to proper Dockerfile quality.

1. `Use Official Images`: Stick to official or verified images to reduce the risk of vulnerabilities.
2. `Minimize Base Images`: Use minimal base images like Alpine to reduce attack surface.
3. `Avoid Running as Root`: Use `USER` to switch to a non-root user for running applications.
4. `Use Multi-Stage Builds`: Separate the build environment from the runtime environment to minimize the final image size and reduce risk.
5. `Specify Exact Versions`: In the `FROM` instruction, specify exact versions of images to avoid unexpected changes.
6. `Keep Secrets Out`: Never hard-code secrets in your Dockerfile. Use secrets management tools or Docker secrets.
7. `Use COPY Over ADD`: Prefer `COPY` for copying local files, use `ADD` for URLs and tar extraction.
8. `Regularly Scan Images for Vulnerabilities`: Integrate security scans into your CI/CD pipeline to catch vulnerabilities early.
9. `Limit Build Context`: Use `.dockerignore` files to exclude unnecessary files from the build context to prevent accidental inclusion of sensitive files.
10. `Keep Containers Up-to-Date`: Regularly update and rebuild containers to include security patches.
